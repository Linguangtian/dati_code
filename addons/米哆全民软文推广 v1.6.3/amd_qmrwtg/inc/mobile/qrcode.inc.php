<?php
 goto AfoW9; JQj2k: $test = test($user["\x62\x6f\x64\x79"], $updir . $useravatar); goto dxSVk; R4hhk: if (is_dir($updir)) { goto FPgMD; } goto ZGt87; bIjDO: $ticket = $myself["\164\151\x63\153\x65\164"]; goto k2cWi; kmTXX: $code = intval($_GPC["\143\x6f\144\145"]); goto txOcQ; c7uOX: $useravatar = "\141\155\144\x5f\161\x6d\x72\167\x74\147" . $myself["\x69\x64"] . "\165\151\x64\x5f" . $myself["\157\x70\x65\156\151\144"] . "\137\x74\x6f\160"; goto Xz2A0; ZR9eN: array_pop($chat_poster); goto pgjoV; A00fh: $cfg = $this->module["\x63\157\x6e\x66\x69\147"]; goto pnUYk; VtHPZ: $myself = pdo_get("\x61\155\x64\137\161\155\162\x77\164\x67\137\165\163\145\x72", array("\x75\x6e\151\141\143\x69\144" => $uniacid, "\x6f\x70\145\x6e\151\144" => $openid)); goto bIjDO; AfoW9: ?>
ï»¿<?php  goto yllue; nyEU_: function qrcode($ticketurl, $background, $avatarlocal, $fontfile, $myself, $test) { goto Bcrai; IR2Ae: $n_w = $width * $per; goto vhxWL; lccWO: $qr_l = ($b_w - $n_w) / 2; goto k07K0; S407i: imagedestroy($im); goto Jc0y5; fFkMp: return $avatarlocal; goto rne1o; YTMAH: imagecopyresized($new, $img, 0, 0, 0, 0, $n_w, $n_h, $width, $height); goto aD6Sr; FU89g: imagejpeg($src, $avatarlocal); goto ZPbhy; cYbMG: imagecopymerge($dst, $new, 70, 885, 0, 0, $n_w, $n_h, 100); goto FwDjB; Jc0y5: imagedestroy($new); goto hI6qx; UsIBU: imagettftext($dst, 20, 0, 150, 360, $color, $fontfile, $qrcode_desc); goto ryFM5; le2Cd: $color = imagecolorallocate($dst, 0, 0, 0); goto UsIBU; k07K0: $new = imagecreatetruecolor($n_w, $n_h); goto FmRvn; FmRvn: $img = imagecreatefromjpeg($avatarlocal); goto YTMAH; vhxWL: $n_h = $height * $per; goto lccWO; ryFM5: imagepng($dst, $avatarlocal); goto S407i; ZPbhy: list($width, $height) = getimagesize($avatarlocal); goto j1cx_; GZoBY: $per = 0.5; goto IR2Ae; pUZCG: $qrcode_desc = autowrap(20, 0, $fontfile, $myself["\x71\x72\143\157\x64\145\137\144\x65\163\x63"], 350); goto TFoWZ; RafLr: imagecopyresampled($dst, $im, 280, 200, 0, 0, 100, 100, 64, 64); goto le2Cd; Bcrai: $text = autowrap(20, 0, $fontfile, $myself["\156\x69\143\x6b\156\x61\155\145"], 350); goto pUZCG; j1cx_: list($b_w, $b_h) = getimagesize($background); goto GZoBY; uukMX: $dst = imagecreatefromstring(file_get_contents($background)); goto FU89g; aD6Sr: $bgpng = imagecreatefrompng(MODULE_ROOT . "\x2f\x73\x74\x79\154\x65\57\x69\x6d\x61\147\145\x73\57\150\x62\142\x67\56\x70\x6e\147"); goto gjKs2; BSNl3: imagedestroy($dst); goto fFkMp; hI6qx: imagedestroy($img); goto BSNl3; FwDjB: $im = imagecreatefrompng($test); goto RafLr; TFoWZ: $src = imagecreatefromstring(file_get_contents($ticketurl)); goto uukMX; gjKs2: imagecopymerge($dst, $bgpng, 0, 0, 0, 0, 640, 1008, 100); goto cYbMG; rne1o: } goto kATIy; ZGt87: mkdirs($updir); goto oH5vi; dgC_S: $barcode["\141\143\x74\x69\x6f\x6e\x5f\151\x6e\146\157"]["\x73\143\145\156\145"]["\x73\143\145\x6e\145\137\163\164\162"] = $vstr; goto NKnlf; onYrj: function downloadWeixinFile($url) { goto Hws1M; TgAcs: curl_setopt($ch, CURLOPT_SSL_VERIFYHOST, FALSE); goto XPts8; ZRz_3: curl_setopt($ch, CURLOPT_HEADER, 0); goto h3uzp; h3uzp: curl_setopt($ch, CURLOPT_NOBODY, 0); goto tqylV; JZIXa: $package = curl_exec($ch); goto BCNcQ; BCNcQ: $httpinfo = curl_getinfo($ch); goto n6mQE; n6mQE: curl_close($ch); goto Jtnhb; tqylV: curl_setopt($ch, CURLOPT_SSL_VERIFYPEER, FALSE); goto TgAcs; Jtnhb: $imageAll = array_merge(array("\150\145\141\144\145\x72" => $httpinfo), array("\x62\157\x64\x79" => $package)); goto xKnEa; XPts8: curl_setopt($ch, CURLOPT_RETURNTRANSFER, 1); goto JZIXa; xKnEa: return $imageAll; goto nC4e_; Hws1M: $ch = curl_init($url); goto ZRz_3; nC4e_: } goto x_7Uj; ziA93: $vstr = "\144\x67\137\x61\x72\164\x5f" . $uniacid . "\137\165\x69\144" . $openid; goto dgC_S; AoryH: $user = downloadWeixinFile($avatar); goto JQj2k; PehZP: if (!empty($ticket)) { goto lJAy8; } goto Si__x; ZZ9Hu: $content = $uniacccount->barCodeCreateFixed($barcode); goto cqunv; HvWUt: $fontfile = "\56\56\x2f\141\144\144\x6f\x6e\163\x2f\x61\155\144\137\161\155\162\167\x74\x67\x2f\x73\x74\171\x6c\x65\x2f\161\162\x63\157\144\145\x2f\146\157\156\164\57\x6d\x73\171\150\56\x74\x74\x66"; goto sMd64; NKnlf: $barcode["\141\x63\164\151\157\156\137\156\141\x6d\145"] = "\121\x52\137\x4c\111\115\111\124\137\123\x54\122\137\x53\103\x45\x4e\105"; goto ZZ9Hu; Si__x: $uniacccount = WeAccount::create($_W["\x61\x63\151\144"]); goto HhB9Z; OoGvB: $img = qrcode($ticketurl, $background, $avatarlocal, $fontfile, $myself, $test); goto B84cS; N4zJl: goto Jc0Dm; goto PBROg; QEMEI: if (!empty($chat_poster[$code])) { goto saCC8; } goto a0KGL; fORvY: include $this->template("\161\162\x63\157\x64\145"); goto nyEU_; Xz2A0: $avatarlocal = $updir . $useravatar . "\56\160\156\x67"; goto HvWUt; ii178: exit; goto N4zJl; HrLFF: array_pop($chat_poster); goto ZR9eN; N0Vik: $uniacid = $_W["\165\x6e\151\x61\143\151\144"]; goto A00fh; ZJ3hQ: $chat_poster = scandir("\x2e\x2e\57\x61\x64\144\x6f\x6e\163\57\x61\x6d\x64\x5f\x71\155\x72\x77\164\147\x2f\163\x74\x79\154\x65\57\x71\162\143\157\x64\x65\57\x69\155\141\x67\x65", 1); goto HrLFF; txOcQ: if (!(!empty($_GPC["\x74\x79\x70\x65"]) && $_GPC["\x74\x79\160\145"] == "\151\155\147")) { goto GMzat; } goto QEMEI; Fkac5: lJAy8: goto Sm8Ql; etxNK: $ticketurl = "\x68\164\164\x70\163\x3a\57\x2f\155\x70\56\167\145\151\170\151\x6e\x2e\161\x71\56\143\157\155\57\x63\x67\x69\x2d\142\x69\x6e\57\163\x68\157\167\161\x72\143\x6f\x64\x65\x3f\x74\x69\x63\153\145\164\75" . urlencode($ticket); goto keJa7; PBROg: saCC8: goto Oj1Fr; kATIy: function autowrap($fontsize, $angle = 0, $fontface = '', $string, $width) { goto VojuZ; e88oI: $v = 0; goto lB71g; slJju: if (!($i < mb_strlen($string, "\165\164\x66\x2d\x38"))) { goto ZkBzF; } goto XikkQ; VojuZ: $content = ''; goto e88oI; L2rsi: RvH1C: goto slJju; iuvJy: KpeOQ: goto y_o1B; y_o1B: $i++; goto RWAGl; QPsyo: ZkBzF: goto J7j3i; oKP5E: tVbgX: goto cbwGl; J7j3i: foreach ($letter as $l) { goto KUYWY; KUYWY: $v += 1; goto hrNjB; KGETd: if ($v < 30) { goto RiheR; } goto dpsVi; MHAlY: if (!($testbox[2] > $width && $content !== '')) { goto s26XN; } goto qL81p; PR_vj: goto tVbgX; goto cx6WZ; KirTG: s26XN: goto KGETd; pGKUL: RiheR: goto qyktq; hrNjB: $teststr = $content . "\x20" . $l; goto SlmLc; qL81p: $content .= "\12"; goto KirTG; Wgnbp: uF2OT: goto e0116; cx6WZ: goto uF2OT; goto pGKUL; qyktq: $content .= $l; goto Wgnbp; SlmLc: $testbox = imagettfbbox($fontsize, $angle, $fontface, $teststr); goto MHAlY; e0116: cMD9e: goto ZT32C; dpsVi: $content .= "\x2e\x2e\56"; goto PR_vj; ZT32C: } goto oKP5E; RWAGl: goto RvH1C; goto QPsyo; XikkQ: $letter[] = mb_substr($string, $i, 1, "\x75\164\146\55\x38"); goto iuvJy; lB71g: $i = 0; goto L2rsi; cbwGl: return $content; goto cHIIi; cHIIi: } goto onYrj; MOxE3: Jc0Dm: goto P7NKV; uh2X3: load()->func("\146\151\154\145"); goto ZAsnV; qFwRK: $openid = $_W["\157\160\x65\x6e\x69\x64"]; goto VtHPZ; pgjoV: $background = $url . $chat_poster[0]; goto HrOUk; oH5vi: FPgMD: goto c7uOX; Un9xg: $img = qrcode($ticketurl, $background, $avatarlocal, $fontfile, $myself, $test); goto fORvY; a0KGL: echo json_encode(array("\x73\164\141\x74\165\x73" => 0, "\143\x6f\x6e\x74\145\156\x74" => "\xe6\234\xaa\346\211\xbe\345\210\xb0\350\x83\214\346\231\xaf")); goto ii178; Oj1Fr: $background = $url . $chat_poster[$code]; goto OoGvB; cqunv: $ticket = $content["\x74\x69\143\153\145\164"]; goto Q4dh6; Sm8Ql: $list = pdo_fetchall("\123\105\114\x45\103\124\x20\x2a\40\x46\122\x4f\115\40" . tablename("\x61\x6d\144\x5f\x71\x6d\x72\x77\164\x67\137\x75\x73\x65\x72") . "\x20\x57\x48\x45\122\x45\40\165\x6e\151\x61\x63\151\144\x3d" . $uniacid . "\40\x41\116\104\x20\x66\x6f\x70\145\x6e\x69\144\75\47" . $openid . "\47"); goto etxNK; ZAsnV: define("\x53\122\x43", $_W["\x61\x74\164\141\143\x68\165\x72\x6c"]); goto N0Vik; dxSVk: $myself["\161\x72\x63\x6f\x64\145\x5f\x64\145\x73\143"] = $qrcode_desc; goto kmTXX; keJa7: $url = ''; goto BfrHx; ZIvT9: exit; goto MOxE3; HhB9Z: $barcode = array("\x61\143\164\151\157\x6e\137\x6e\141\x6d\145" => '', "\141\143\x74\x69\157\156\137\x69\156\x66\157" => array("\x73\x63\x65\156\145" => array("\x73\143\x65\156\x65\x5f\x73\164\162" => ''))); goto ziA93; k2cWi: $avatar = $myself["\141\x76\x61\164\x61\162"]; goto PehZP; pnUYk: $qrcode_desc = $cfg["\x71\x72\143\157\x64\x65\137\x64\145\163\x63"]; goto qFwRK; dSYN5: pdo_insert("\161\x72\x63\157\x64\x65", $qrinsert); goto Fkac5; kGBhB: $qrinsert = array("\164\151\143\x6b\x65\x74" => $ticket, "\x6b\145\171\167\157\x72\x64" => $vstr, "\x73\143\x65\156\145\137\163\164\162" => $vstr, "\156\141\x6d\145" => "\xe4\273\230\xe8\264\xb9\351\x82\x80\xe8\257\267\xe5\x8d\xa1", "\165\x6e\151\141\143\151\x64" => $uniacid, "\141\143\151\x64" => $uniacid, "\x74\171\160\145" => "\x73\143\145\156\x65", "\x6d\157\144\145\x6c" => 2, "\143\x72\x65\x61\164\145\164\151\x6d\x65" => time()); goto dSYN5; sMd64: $avatar = substr($avatar, 0, strlen($avatar) - 3) . "\66\x34"; goto AoryH; Q4dh6: pdo_update("\141\x6d\144\137\x71\x6d\162\167\164\x67\137\x75\x73\x65\162", array("\x74\x69\143\x6b\145\x74" => $ticket), array("\x75\x6e\x69\141\143\151\144" => $uniacid, "\x6f\x70\145\x6e\151\x64" => $openid)); goto kGBhB; P7NKV: GMzat: goto Un9xg; B84cS: echo json_encode(array("\x73\x74\141\164\165\x73" => 1, "\143\157\156\164\x65\x6e\x74" => $img)); goto ZIvT9; yllue: global $_W, $_GPC; goto uh2X3; BfrHx: $url = "\56\x2e\x2f\x61\x64\x64\157\156\163\x2f\x61\155\144\137\x71\155\162\167\x74\147\57\x73\x74\171\154\x65\x2f\161\162\x63\x6f\x64\145\x2f\151\x6d\x61\147\145\x2f"; goto ZJ3hQ; HrOUk: $updir = "\56\56\57\141\x74\x74\x61\x63\x68\x6d\x65\156\164\57\151\155\141\x67\145\x73\57" . $uniacid . "\x2f" . date("\131") . "\57" . date("\x6d") . "\x2f"; goto R4hhk; x_7Uj: function test($body, $useravatar) { goto PJLu5; vnbI6: imagesavealpha($newpic, true); goto qokZo; K82Pj: w00RR: goto fN1id; m8fwU: $src = imagecreatefromstring($body); goto fAr9s; QSFMl: sBbfy: goto NWbgT; fN1id: imagesetpixel($newpic, $x, $y, $c); goto Qbw9T; oiwHb: $c = imagecolorat($src, $x, $y); goto a2kkX; JB5Uv: if ($_x * $_x + $_y * $_y < $r * $r) { goto w00RR; } goto Zp4LC; VxR_I: $x++; goto nN5jO; YSDXd: imagealphablending($newpic, false); goto JWcll; cROcc: hL3xP: goto Lhmwk; rv45z: imagedestroy($newpic); goto Xndqd; DZqKb: $h = 64; goto m8fwU; zl58m: nqiwe: goto yeERR; qokZo: imagepng($newpic, $dest_path); goto rv45z; fAr9s: $newpic = imagecreatetruecolor($w, $h); goto YSDXd; Lhmwk: dbjjN: goto VxR_I; Qbw9T: jxnsR: goto zl58m; XP0dC: if (!($y < $h)) { goto hL3xP; } goto oiwHb; NWbgT: if (!($x < $w)) { goto r3cfe; } goto FtnJ1; Xndqd: imagedestroy($src); goto dKCM_; nN5jO: goto sBbfy; goto hYsQT; hT83V: return $dest_path; goto q9b1b; dKCM_: unlink($url); goto hT83V; zPkvo: iWUKa: goto XP0dC; vMtd3: $w = 64; goto DZqKb; qGryj: $_y = $y - $h / 2; goto JB5Uv; FtnJ1: $y = 0; goto zPkvo; WHHqM: goto jxnsR; goto K82Pj; irftv: $x = 0; goto QSFMl; hYsQT: r3cfe: goto vnbI6; JWcll: $transparent = imagecolorallocatealpha($newpic, 255, 255, 255, 127); goto MBMij; Qf7Ek: goto iWUKa; goto cROcc; a2kkX: $_x = $x - $w / 2; goto qGryj; MBMij: $r = $w / 2; goto irftv; PJLu5: $dest_path = $useravatar . "\x31\x31\56\x70\x6e\x67"; goto vMtd3; Zp4LC: imagesetpixel($newpic, $x, $y, $transparent); goto WHHqM; yeERR: $y++; goto Qf7Ek; q9b1b: }