<?php
 class Oauth2 { public static $SCOPE_BASE = "\x73\156\163\141\160\x69\x5f\x62\x61\163\x65"; public static $SCOPE_USERINFO = "\x73\156\x73\141\x70\x69\137\x75\163\x65\162\x69\156\146\157"; private $appid = ''; private $secret = ''; private $party = null; private $current_account = null; function __construct($current_account) { goto RABhr; RABhr: $this->appid = $current_account["\153\145\171"]; goto gSIb3; HBUg0: load()->classs("\164\x68\151\162\144\x70\x61\x72\164\x79\56\x61\143\143\x6f\165\156\164"); goto pzoiZ; kGoOI: if (!($current_account["\164\x79\160\x65"] == 4)) { goto quSAi; } goto HBUg0; pzoiZ: $this->party = new ThirdPartyAccount(); goto T24tG; NcmX3: Wuix3: goto RVO2q; Dkt9x: $this->party = new WeiXinPlatform($current_account); goto NcmX3; oOygj: if (!($current_account["\x74\171\x70\145"] == 3)) { goto Wuix3; } goto sKP7B; gSIb3: $this->secret = $current_account["\x73\145\143\x72\x65\x74"]; goto yWiZ0; yWiZ0: $this->current_account = $current_account; goto kGoOI; T24tG: quSAi: goto oOygj; sKP7B: load()->classs("\167\145\x69\x78\x69\156\56\x70\x6c\x61\x74\146\x6f\162\155"); goto Dkt9x; RVO2q: } public function authorization_code($redirect_uri, $scope, $state) { goto HX0BA; fdbBT: if (!($this->current_account["\x74\171\x70\x65"] == 3)) { goto x5U1o; } goto L62t9; B5zA6: header("\154\x6f\x63\x61\164\151\x6f\156\x3a\x20{$url}"); goto W4mDJ; L62t9: $url = "\150\164\x74\160\163\72\57\57\157\160\145\x6e\x2e\167\x65\151\170\x69\156\x2e\x71\161\x2e\143\157\155\57\x63\157\x6e\x6e\x65\x63\164\x2f\x6f\x61\165\x74\150\62\x2f\141\x75\x74\x68\157\162\151\x7a\145\77\x61\x70\x70\151\144\75" . $this->appid . "\46\x72\x65\x64\x69\x72\x65\x63\164\137\165\x72\x69\x3d" . urlencode($redirect_uri) . "\46\x72\145\x73\x70\x6f\x6e\163\x65\137\x74\x79\160\145\75\143\x6f\x64\x65\x26\x73\143\157\x70\x65\x3d" . $scope . "\x26\x73\164\x61\x74\145\75" . $state . "\46\x63\x6f\x6d\x70\157\156\145\x6e\x74\137\x61\x70\160\151\x64\75{$this->party->appid}\43\x77\x65\143\x68\141\164\x5f\x72\145\x64\151\162\145\143\164"; goto YWweM; AiKc_: $url = "\x68\x74\164\x70\163\72\x2f\x2f\157\x70\145\156\x2e\x77\x65\x69\x78\x69\x6e\x2e\x71\161\x2e\143\157\x6d\57\143\x6f\156\x6e\145\143\164\x2f\157\x61\x75\164\150\62\57\x61\165\164\150\x6f\x72\x69\x7a\145\77\x61\160\x70\x69\x64\75" . $this->appid . "\46\x72\x65\x64\x69\x72\145\x63\x74\x5f\165\162\x69\75" . urlencode($redirect_uri) . "\46\x72\x65\163\160\157\156\163\x65\x5f\x74\171\160\145\x3d\143\x6f\144\145\46\x73\x63\157\160\x65\x3d" . $scope . "\x26\163\x74\x61\x74\145\x3d" . $state . "\46\143\157\155\160\x6f\156\145\x6e\x74\137\x61\160\160\x69\x64\x3d{$this->party->appid}\43\167\x65\143\150\x61\x74\137\162\x65\144\151\162\145\143\164"; goto qok6w; HX0BA: $url = "\150\x74\x74\160\163\x3a\57\57\x6f\x70\145\156\56\x77\x65\151\x78\151\x6e\56\x71\161\x2e\x63\x6f\155\57\x63\x6f\156\156\x65\x63\x74\57\157\141\x75\x74\150\62\x2f\x61\x75\164\x68\157\162\151\172\x65\77\141\160\160\x69\x64\x3d" . $this->appid . "\x26\162\x65\x64\151\162\145\143\164\137\165\x72\151\x3d" . urlencode($redirect_uri) . "\x26\162\145\x73\x70\157\156\163\145\137\164\x79\160\x65\75\143\157\x64\x65\46\163\x63\157\160\145\x3d" . $scope . "\x26\x73\164\141\164\x65\75" . $state . "\43\x77\145\x63\150\141\x74\x5f\162\145\144\x69\x72\x65\x63\x74"; goto fdbBT; VrZ5k: if (!($this->current_account["\164\x79\160\x65"] == 4)) { goto krmEV; } goto AiKc_; qok6w: krmEV: goto B5zA6; YWweM: x5U1o: goto VrZ5k; W4mDJ: } public function getOauthAccessToken($code) { goto CCf2B; Amioc: if (!(empty($token) || !is_array($token) || empty($token["\x61\x63\x63\145\x73\x73\x5f\164\157\153\145\x6e"]) || empty($token["\x6f\160\x65\156\151\144"]))) { goto S4Nah; } goto hGelS; m4ZIn: $token = @json_decode($content["\x63\x6f\x6e\164\x65\x6e\164"], true); goto Amioc; kORe4: S4Nah: goto SKLXe; SKLXe: return $token; goto TKxRV; Hcd8M: $oauth2_code = "\x68\164\164\x70\163\x3a\57\57\141\x70\151\x2e\167\x65\151\x78\151\156\56\x71\x71\x2e\143\x6f\x6d\x2f\163\156\x73\57\x6f\141\x75\164\x68\62\x2f\x61\x63\143\145\163\163\x5f\x74\x6f\x6b\x65\156\x3f\x61\160\x70\x69\144\75" . $this->appid . "\x26\163\145\x63\162\145\164\75" . $this->secret . "\x26\x63\157\144\x65\x3d" . $code . "\x26\x67\x72\141\156\164\x5f\x74\x79\x70\x65\x3d\x61\165\164\150\x6f\x72\x69\x7a\x61\164\x69\x6f\156\x5f\143\157\x64\x65"; goto uszoS; EsxZW: Yz5Gx: goto FQ0hH; OWcbI: $url = "\x68\164\x74\x70\x73\72\57\x2f\141\x70\x69\x2e\167\145\x69\x78\x69\156\56\161\161\56\143\x6f\155\x2f\x73\x6e\x73\x2f\x6f\x61\165\x74\x68\x32\57\143\157\155\x70\157\156\x65\x6e\x74\x2f\141\143\x63\x65\163\163\x5f\164\x6f\153\145\x6e\77\x61\160\160\x69\x64\75{$this->appid}\x26\x63\157\144\x65\75{$code}\46\x67\162\141\156\x74\137\164\x79\160\x65\x3d\141\165\164\x68\x6f\x72\151\172\141\164\x69\x6f\x6e\137\x63\157\144\x65\x26\x63\157\155\x70\x6f\x6e\145\x6e\164\137\141\x70\x70\151\144\75{$this->party->appid}\x26\x63\157\x6d\160\157\156\x65\156\x74\x5f\141\x63\143\x65\163\163\137\164\x6f\153\x65\156\75{$this->party->get_component_token()}"; goto XuQRj; hGelS: echo "\74\150\x31\x3e\350\216\xb7\xe5\x8f\x96\xe5\276\xae\xe4\xbf\xa1\345\205\254\xe4\274\x97\xe5\x8f\267\346\x8e\210\xe6\x9d\203" . $code . "\xe5\xa4\xb1\xe8\264\xa5\x5b\xe6\227\240\346\xb3\x95\xe5\x8f\x96\345\276\227\164\x6f\153\145\156\xe4\273\245\xe5\217\x8a\157\x70\145\156\151\144\135\x2c\40\xe8\xaf\267\347\250\x8d\xe5\220\x8e\351\207\x8d\xe8\xaf\x95\xef\274\201\40\345\x85\254\xe4\274\x97\345\271\263\xe5\x8f\xb0\xe8\xbf\224\345\x9b\x9e\345\216\237\345\xa7\213\xe6\x95\xb0\346\215\256\344\270\272\x3a\x20\74\x62\162\40\57\76" . $content["\155\x65\164\141"] . "\x3c\150\61\x3e"; goto y___O; XuQRj: dWFX_: goto laI92; v898g: $oauth2_code = "\x68\164\164\160\163\72\x2f\x2f\141\x70\x69\x2e\167\x65\151\x78\x69\x6e\x2e\x71\x71\56\x63\x6f\155\57\163\156\163\x2f\157\141\x75\164\150\62\57\143\x6f\155\x70\157\156\145\x6e\164\x2f\141\143\143\x65\163\x73\137\164\157\x6b\145\156\x3f\x61\160\160\151\x64\x3d{$this->appid}\46\x63\157\144\x65\x3d{$code}\x26\147\162\x61\156\164\137\x74\x79\160\145\x3d\x61\x75\164\150\x6f\162\x69\x7a\x61\164\151\x6f\156\x5f\143\x6f\144\145\x26\x63\157\x6d\160\157\x6e\145\156\164\137\141\160\x70\x69\x64\75{$this->party->appid}\46\x63\157\x6d\160\157\156\x65\156\164\137\x61\x63\x63\x65\x73\163\x5f\x74\x6f\x6b\145\156\75{$this->party->getComponentAccesstoken()}"; goto EsxZW; CCf2B: load()->func("\143\157\x6d\x6d\x75\156\151\143\141\x74\151\x6f\x6e"); goto Hcd8M; FQ0hH: if (!($this->current_account["\x74\171\x70\145"] == 4)) { goto dWFX_; } goto OWcbI; y___O: exit; goto kORe4; uszoS: if (!($this->current_account["\164\171\x70\145"] == 3)) { goto Yz5Gx; } goto v898g; laI92: $content = ihttp_get($oauth2_code); goto m4ZIn; TKxRV: } public function getOauthUserInfo($openid, $accessToken) { goto tsIIg; CVbhn: $tokenUrl = "\150\x74\x74\x70\163\72\x2f\x2f\x61\x70\151\x2e\167\x65\151\x78\151\156\x2e\x71\161\x2e\143\x6f\155\57\x73\156\x73\57\x75\x73\x65\162\151\x6e\x66\x6f\x3f\141\x63\x63\x65\163\x73\x5f\164\x6f\153\x65\156\75" . $accessToken . "\46\x6f\160\145\x6e\151\144\x3d" . $openid . "\46\154\141\x6e\x67\75\172\x68\x5f\103\x4e"; goto MkJ2A; pwyuI: return $userInfo; goto Pclis; MkJ2A: $content = ihttp_get($tokenUrl); goto X6nO_; X6nO_: $userInfo = @json_decode($content["\143\x6f\156\164\x65\156\164"], true); goto pwyuI; tsIIg: load()->func("\x63\157\x6d\x6d\x75\x6e\x69\x63\x61\164\x69\157\156"); goto CVbhn; Pclis: } public function getUserInfo($access_token, $openid) { goto hdr2r; TJ3G1: $userInfo = @json_decode($content["\143\157\156\x74\x65\156\164"], true); goto Isx0O; rbHLI: $content = ihttp_get($api_url); goto TJ3G1; PVlph: $api_url = "\150\x74\164\x70\x73\x3a\57\x2f\x61\160\151\x2e\167\x65\x69\x78\x69\156\x2e\x71\161\x2e\x63\157\x6d\57\x63\x67\x69\55\x62\x69\156\x2f\165\x73\145\x72\57\151\156\x66\157\77\x61\x63\143\145\x73\163\137\x74\x6f\x6b\145\156\x3d" . $access_token . "\x26\x6f\160\x65\156\x69\x64\x3d" . $openid . "\46\154\x61\156\147\x3d\x7a\150\137\x43\x4e"; goto rbHLI; hdr2r: load()->func("\x63\157\x6d\155\x75\x6e\151\x63\141\164\x69\157\x6e"); goto PVlph; Isx0O: return $userInfo; goto nSca9; nSca9: } public static function setClientCookieUserInfo($userInfo = array(), $cookieKey) { goto WN20O; yyEgm: $cookie["\150\x65\x61\144\151\155\147\x75\x72\x6c"] = $userInfo["\x68\x65\141\x64\x69\x6d\147\165\x72\x6c"]; goto uYjeY; gnSI2: $cookie = array(); goto AK2z7; N7gzA: isetcookie($cookieKey, $session, 48 * 3600 * 1); goto hAgX1; Syz76: $cookie["\x75\151\144"] = $userInfo["\165\151\x64"]; goto ZBEDs; ZBEDs: $cookie["\156\151\143\153\156\x61\x6d\145"] = $userInfo["\x6e\151\x63\x6b\x6e\x61\x6d\145"]; goto yyEgm; AK2z7: $cookie["\157\160\145\156\x69\x64"] = $userInfo["\x6f\160\145\x6e\x69\x64"]; goto Syz76; DsArS: aLCiZ: goto FIdkH; uYjeY: $session = base64_encode(json_encode($cookie)); goto N7gzA; hAgX1: return $session; goto DsArS; WN20O: if (!(!empty($userInfo) && !empty($userInfo["\x6f\160\x65\156\151\x64"]))) { goto aLCiZ; } goto gnSI2; FIdkH: } }